#
# (C) Copyright IBM Corp. 2020
#
# SPDX-License-Identifier: Apache-2.0
#
---
resourceType: Condition
id:
  type: STRING
  valueOf: 'UUID.randomUUID()'
  expressionType: JEXL

identifier_1:
  valueOf: datatype/Identifier_var
  generateList: true
  expressionType: resource
  vars:
    valueIn: PV1.19 | PID.18 | MSH.10
  constants:
    system: "http://terminology.hl7.org/CodeSystem/v2-0203"
    code: "VN"
    display: "Visitor Number"

identifier_2:
  condition: DG1.1 NOT_NULL
  valueOf: datatype/Identifier
  generateList: true
  expressionType: resource
  vars:
    system: SYSTEM_URL, $sys
    value: BUILD_FROM_CWE, DG1.1
  constants:
    sys: "urn:id:extID"

identifier_3:
  valueOf: datatype/Identifier
  expressionType: resource
  vars:
    system: SYSTEM_URL, $sys
    value: PRB.4.1
  constants:
    sys: "urn:id:extID"

category_x1:
   valueOf: datatype/CodeableConcept_var
   generateList: true
   expressionType: resource
   condition:  $source NOT_NULL
   vars:     
     code: CONDITION_CATEGORY_CODES, $type
     text: $type
     source: PRB.3
   constants:
      type: problem-list-item

category_x2:
   valueOf: datatype/CodeableConcept_var
   generateList: true
   expressionType: resource
   condition:  $source NULL
   vars:     
     code: CONDITION_CATEGORY_CODES, $type
     text: $type
     source: PRB.3
   constants:
      type: encounter-diagnosis
           

severity:
   valueOf: datatype/CodeableConcept
   generateList: true
   expressionType: resource
   specs: PRB.26
   vars:
     code: PRB.26
     
code:
   valueOf: datatype/CodeableConcept
   generateList: true
   expressionType: resource
   specs: PRB.3
   vars:
     code: PRB.3
     
     
encounter:
    valueOf: datatype/Reference
    expressionType: resource
    specs: $Encounter
      
subject:
    valueOf: datatype/Reference
    expressionType: resource
    specs: $Patient

onsetDateTime:
     type: DATE_TIME
     valueOf: PRB.16 
     expressionType: HL7Spec

stage:
   valueOf: secondary/Stage
   generateList: true
   expressionType: resource
   specs: PRB.14
   vars:
     code: PRB.14
evidence:
   valueOf: secondary/evidence
   generateList: true
   expressionType: resource
   specs: $Observation
   useGroup: true

